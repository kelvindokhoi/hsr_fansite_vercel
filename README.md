# Honkai: Star Rail Fan Site ‚Äî Integrated Cloud Evolution

This repository represents the **production-ready, hybrid-cloud evolution** of the Honkai: Star Rail Fan Site. It shifts the project from a local development environment (MAMP/MySQL) to a scalable, secure, and distributed architectural model.

> üìå **Original (Local MySQL + MAMP) Project:**
> [https://github.com/kelvindokhoi/hsr_fansite](https://github.com/kelvindokhoi/hsr_fansite)

This version is designed for a live environment, utilizing a distributed stack of free-tier cloud services to provide high availability and secure HTTPS delivery.

---

## üåê Hybrid Cloud Architecture

The live application is powered by a coordinated "Triple-Cloud" stack:

*   **Vercel** ‚Äî **Frontend Layer**: Hosts the React + Vite application with automatic HTTPS and edge delivery.
*   **Oracle Cloud (OCI)** ‚Äî **Backend Layer**: A dedicated Ubuntu VM running Apache/PHP for the API logic and high-resolution asset storage.
*   **Supabase (PostgreSQL)** ‚Äî **Data Layer**: A cloud-hosted PostgreSQL database managing user accounts, gacha balances, and the character roster.

### Technical Evolution:
| Feature | Original (Local) | Modern (Cloud) |
| :--- | :--- | :--- |
| **Database** | MySQL | PostgreSQL (Supabase) |
| **API Host** | MAMP (localhost) | Oracle Cloud (Ubuntu VM) |
| **Asset Storage** | Local folder | Public Webroot on OCI |
| **Security** | None (HTTP) | Let's Encrypt SSL (HTTPS) |
| **Anti-Bot** | None | Cloudflare Turnstile (Invisible CAPTCHA) |
| **DNS** | None | DuckDNS (Dynamic DNS) |

---

## üñ•Ô∏è Backend Infrastructure Setup (OCI + SSL)

To replicate this production environment on your own Oracle Cloud instance:

### 1Ô∏è‚É£ Network Configuration (VCN)
Ensure your Oracle Cloud **Ingress Rules** allow traffic on the following ports:
*   **Port 80 (HTTP)**: Required for Initial Certbot verification and HTTP traffic.
*   **Port 443 (HTTPS)**: Required for secure API and asset delivery.

Apply these rules at the OS level (IPtables):
```bash
sudo iptables -I INPUT 6 -m state --state NEW -p tcp --dport 80 -j ACCEPT
sudo iptables -I INPUT 6 -m state --state NEW -p tcp --dport 443 -j ACCEPT
sudo netfilter-persistent save
```

### 2Ô∏è‚É£ Dynamic DNS & SSL (DuckDNS + Certbot)
To prevent "Mixed Content" blocks on Vercel (HTTPS), your backend MUST also use HTTPS.
1.  Set up a free domain at [DuckDNS](https://www.duckdns.org/).
2.  Install Certbot on your Ubuntu VM:
    ```bash
    sudo apt update
    sudo apt install certbot python3-certbot-apache
    ```
3.  Generate your SSL certificate:
    ```bash
    sudo certbot --apache -d your-domain.duckdns.org
    ```

### 3Ô∏è‚É£ Bot Protection (Cloudflare Turnstile)
To protect your login and registration endpoints:
1.  Create a **Turnstile Widget** in your Cloudflare dashboard.
2.  Add your **Secret Key** to the backend `.env` file on your OCI VM:
    ```bash
    # /var/www/html/hsrapp_oracle_to_supabase/.env
    TURNSTILE_SECRET_KEY=your_secret_key_here
    ```

### 4Ô∏è‚É£ File Structure
Place the production PHP files from `hsrapp_oracle_to_supabase/` into your server's webroot:
*   **API Logic**: `/var/www/html/hsrapp_oracle_to_supabase/`
*   **Static Assets**: `/var/www/html/public/images/`

---

## ‚öôÔ∏è Vercel Frontend Configuration

The following **Environment Variables** are required in your Vercel Project Settings for the app to function:

| Variable | Purpose | Example Value |
| :--- | :--- | :--- |
| `VITE_API_URL` | Endpoint for the PHP API | `https://your-domain.duckdns.org/hsrapp_oracle_to_supabase/api` |
| `VITE_IMAGE_BASE_URL` | Base path for cloud-hosted images | `https://your-domain.duckdns.org/public` |
| `VITE_SUPABASE_URL` | Supabase project URL | `https://xxxx.supabase.co` |
| `VITE_SUPABASE_ANON_KEY` | Public access key for Supabase | `your-anon-key` |

---

## üóÑÔ∏è Supabase (PostgreSQL) Database Schema

The production database requires the following schema in the Supabase SQL Editor:

```sql
-- Role Management
CREATE TABLE roles (
  id INT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
  role_name TEXT NOT NULL UNIQUE
);

INSERT INTO roles (role_name) VALUES ('admin'), ('user');

-- Character Roster
CREATE TABLE public.characters (
  id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name TEXT UNIQUE NOT NULL,
  rarity INT NOT NULL CHECK (rarity IN (4, 5)),
  element TEXT NOT NULL,
  path TEXT NOT NULL,
  description TEXT DEFAULT '',
  image_extension TEXT DEFAULT 'png'
);

-- User Accounts
CREATE TABLE users (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  username TEXT NOT NULL UNIQUE,
  password_hash TEXT NOT NULL,
  created_at TIMESTAMP DEFAULT now() NOT NULL,
  stellar_jade_balance BIGINT NOT NULL DEFAULT 1600,
  role_id INT REFERENCES public.roles(id)
);
```

---

## üîÅ Relationship with Original Project

*   **hsr_fansite**: Focuses on **how to build** a full-stack React application.
*   **hsr_fansite_vercel**: Focuses on **how to deploy and secure** that application in the cloud.

Together, they represent the journey from **Local Prototype** to **Cloud Production**.

---

Made with ‚ù§Ô∏è by Kelvin & Antigravity AI
